# RAMS PROTOCOL v3.0 - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–∞—Ç–∞:** 15 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–í–µ—Ä—Å–∏—è:** 3.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ READY FOR PRODUCTION

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–±–ª–æ–∫–æ–≤)
4. [–ü—Ä–æ—Ç–æ–∫–æ–ª —Å–≤—è–∑–∏](#–ø—Ä–æ—Ç–æ–∫–æ–ª-—Å–≤—è–∑–∏)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Next.js UI    ‚îÇ  –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTTP (WiFi)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        ESP32                 ‚îÇ  –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
‚îÇ  rams_controller_v3.ino      ‚îÇ  + LED —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îî‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ Serial (—Ç–µ–∫—Å—Ç)         ‚îÇ Serial (—Ç–µ–∫—Å—Ç)
  ‚ñº                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Mega #1     ‚îÇ      ‚îÇ  Mega #2     ‚îÇ  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç—É–∞—Ç–æ—Ä–∞–º–∏
‚îÇ  –ë–ª–æ–∫–∏ 1-8   ‚îÇ      ‚îÇ  –ë–ª–æ–∫–∏ 9-15  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **–û–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª** (`ACTUATOR_CONFIG.h`)
‚úÖ **–¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª** (–±—ã—Å—Ç—Ä–µ–µ JSON –≤ 10x —Ä–∞–∑)
‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥** (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥** (ESP32 —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç Mega)
‚úÖ **Heartbeat** (PING/PONG –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫)
‚úÖ **–õ–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–ª–æ–∫–æ–≤** (–º–∞–∫—Å 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
‚úÖ **LED —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (–ø–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
firmware/
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îî‚îÄ‚îÄ ACTUATOR_CONFIG.h          ‚Üê –û–ë–©–ò–ô –ö–û–ù–§–ò–ì (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ)
‚îÇ
‚îú‚îÄ‚îÄ esp32/
‚îÇ   ‚îî‚îÄ‚îÄ rams_controller_v3/
‚îÇ       ‚îî‚îÄ‚îÄ rams_controller_v3.ino  ‚Üê ESP32 firmware
‚îÇ
‚îî‚îÄ‚îÄ arduino_mega/
    ‚îú‚îÄ‚îÄ actuator_mega1_v3/
    ‚îÇ   ‚îî‚îÄ‚îÄ actuator_mega1_v3.ino   ‚Üê Mega #1 firmware (–±–ª–æ–∫–∏ 1-8)
    ‚îî‚îÄ‚îÄ actuator_mega2_v3/
        ‚îî‚îÄ‚îÄ actuator_mega2_v3.ino   ‚Üê Mega #2 firmware (–±–ª–æ–∫–∏ 9-15)
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **ESP32** –ø–æ–ª—É—á–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å –æ—Ç Next.js
2. **ESP32** —á–∏—Ç–∞–µ—Ç `ACTUATOR_CONFIG.h` –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫–∞—è Mega –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–ª–æ–∫
3. **ESP32** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É –Ω–∞ –Ω—É–∂–Ω—É—é Mega —á–µ—Ä–µ–∑ Serial
4. **Mega** –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É, –ø–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ `sscanf()`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç
5. **Mega** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ ESP32
6. **Mega** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–ª–æ–∫ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ duration
7. **Mega** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç DONE (–∑–∞–≤–µ—Ä—à–µ–Ω–æ) ESP32
8. **ESP32** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç LED –ø–æ–¥—Å–≤–µ—Ç–∫—É

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤

### –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

**–§–∞–π–ª:** `firmware/shared/ACTUATOR_CONFIG.h`

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–í–°–ï** –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏—Å—Ç–µ–º—ã:
- –ú–∞–ø–ø–∏–Ω–≥ –±–ª–æ–∫–æ–≤ –Ω–∞ –ø–∏–Ω—ã
- –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–≤—è–∑–∏ (–∫–æ–º–∞–Ω–¥—ã, —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏)
- –õ–æ–≥–∏–∫–∞ —Ä–µ–ª–µ (–∏–Ω–≤–µ—Ä—Å–Ω–∞—è)
- Baud rate, —Ç–∞–π–º–∞—É—Ç—ã, –ª–∏–º–∏—Ç—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```cpp
struct BlockConfig {
  uint8_t blockNum;           // –ù–æ–º–µ—Ä –±–ª–æ–∫–∞ (1-15)
  uint8_t megaNum;            // Mega #1 –∏–ª–∏ #2
  ActuatorPins actuator1;     // –ê–∫—Ç—É–∞—Ç–æ—Ä 1 (upPin, downPin)
  ActuatorPins actuator2;     // –ê–∫—Ç—É–∞—Ç–æ—Ä 2 (upPin, downPin)
  ActuatorPins actuator3;     // –ê–∫—Ç—É–∞—Ç–æ—Ä 3 (—Ç–æ–ª—å–∫–æ –±–ª–æ–∫ 15)
  uint8_t actuatorCount;      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç—É–∞—Ç–æ—Ä–æ–≤ (2 –∏–ª–∏ 3)
};
```

### –ú–∞–ø–ø–∏–Ω–≥ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

| –ë–ª–æ–∫ | Mega | Act1 UP | Act1 DOWN | Act2 UP | Act2 DOWN | Act3 UP | Act3 DOWN | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------|------|---------|-----------|---------|-----------|---------|-----------|------------|
| 1 | #1 | 22 | 23 | 24 | 25 | - | - | |
| 2 | #1 | 26 | 27 | 28 | 29 | - | - | |
| 3 | #1 | 30 | 31 | 32 | 33 | - | - | |
| 4 | #1 | 34 | 35 | 36 | 37 | - | - | |
| 5 | #1 | 38 | 39 | 40 | 41 | - | - | |
| **6** | #1 | **50** | **51** | **52** | **53** | - | - | ‚ö†Ô∏è –§–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–ø–∞—è–Ω |
| **7** | #1 | **42** | **43** | **44** | **45** | - | - | ‚ö†Ô∏è –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω |
| **8** | #1 | **46** | **47** | **48** | **49** | - | - | ‚ö†Ô∏è –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω |
| 9 | #2 | 22 | 23 | 24 | 25 | - | - | |
| 10 | #2 | 26 | 27 | 28 | 29 | - | - | |
| 11 | #2 | 30 | 31 | 32 | 33 | - | - | |
| 12 | #2 | 34 | 35 | 36 | 37 | - | - | |
| 13 | #2 | 38 | 39 | 40 | 41 | - | - | |
| **14** | #2 | **50** | **51** | **52** | **53** | - | - | ‚ö†Ô∏è –§–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–ø–∞—è–Ω |
| **15** | #2 | **42** | **43** | **44** | **45** | **46** | **47** | ‚ö†Ô∏è **3 –ê–ö–¢–£–ê–¢–û–†–ê!** |

### –õ–æ–≥–∏–∫–∞ —Ä–µ–ª–µ

```cpp
#define RELAY_ON   LOW   // –ò–Ω–≤–µ—Ä—Å–Ω–∞—è –ª–æ–≥–∏–∫–∞: LOW = –≤–∫–ª—é—á–µ–Ω–æ
#define RELAY_OFF  HIGH  // HIGH = –≤—ã–∫–ª—é—á–µ–Ω–æ
```

**–í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∏–Ω–≤–µ—Ä—Å–Ω–∞—è –ª–æ–≥–∏–∫–∞**!

- `digitalWrite(pin, LOW)` ‚Üí —Ä–µ–ª–µ –í–ö–õ–Æ–ß–ï–ù–û ‚Üí –∞–∫—Ç—É–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- `digitalWrite(pin, HIGH)` ‚Üí —Ä–µ–ª–µ –í–´–ö–õ–Æ–ß–ï–ù–û ‚Üí –∞–∫—Ç—É–∞—Ç–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–≤—è–∑–∏

### –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (vs JSON)

**–ü–æ—á–µ–º—É —Ç–µ–∫—Å—Ç–æ–≤—ã–π?**
- ‚ö° **–í 10x –±—ã—Å—Ç—Ä–µ–µ** –ø–∞—Ä—Å–∏–Ω–≥ (sscanf vs ArduinoJson)
- üíæ **–í 2x –º–µ–Ω—å—à–µ** –ø–∞–º—è—Ç–∏ (20 –±–∞–π—Ç vs 256 –±–∞–π—Ç)
- üîß **–ü—Ä–æ—â–µ** –æ—Ç–ª–∞–¥–∫–∞ (—á–∏—Ç–∞–µ–º—ã–π –ª–æ–≥)
- üöÄ **–ù–∞–¥—ë–∂–Ω–µ–µ** (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫)

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
```
JSON:  {"block":5,"action":"up","duration":10000}\n   (45 –±–∞–π—Ç)
TEXT:  BLOCK:5:UP:10000\n                            (19 –±–∞–π—Ç)

–≠–ö–û–ù–û–ú–ò–Ø: 58% –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö!
```

### –§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥

#### ESP32 ‚Üí Mega

```
BLOCK:5:UP:10000\n          - –ë–ª–æ–∫ 5 –≤–≤–µ—Ä—Ö –Ω–∞ 10 —Å–µ–∫
BLOCK:3:DOWN:5000\n         - –ë–ª–æ–∫ 3 –≤–Ω–∏–∑ –Ω–∞ 5 —Å–µ–∫
BLOCK:7:STOP\n              - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫ 7
ALL:STOP\n                  - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –±–ª–æ–∫–∏
PING\n                      - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ (heartbeat)
```

**–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å:** `:` (–¥–≤–æ–µ—Ç–æ—á–∏–µ)
**–û–∫–æ–Ω—á–∞–Ω–∏–µ:** `\n` (newline)

#### Mega ‚Üí ESP32

```
ACK:5:UP\n                  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
DONE:5\n                    - –ë–ª–æ–∫ –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É (—Ç–∞–π–º–∞—É—Ç)
PONG\n                      - –û—Ç–≤–µ—Ç –Ω–∞ PING
ERROR:message\n             - –û—à–∏–±–∫–∞
```

### –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥

#### –ù–∞ Mega (–±—ã—Å—Ç—Ä–æ, –∫–∞–∫ –≤ DroneControl.ino):

```cpp
// –§–æ—Ä–º–∞—Ç: BLOCK:5:UP:10000
int blockNum = 0;
char action[10];
int duration = 0;

int parsed = sscanf(cmd.c_str(), "BLOCK:%d:%[^:]:%d", &blockNum, action, &duration);

if (parsed >= 2) {
  // –ö–æ–º–∞–Ω–¥–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞!
  if (strcmp(action, "UP") == 0) {
    blockUp(blockNum, duration);
  }
}
```

**–í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞:** ~0.1 –º—Å (vs ~2-5 –º—Å –¥–ª—è JSON)

#### –ù–∞ ESP32:

```cpp
// –§–æ—Ä–º–∞—Ç: ACK:5:UP
if (response.startsWith("ACK:")) {
  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ
  Serial.println("Block acknowledged");
}
else if (response.startsWith("DONE:")) {
  // –ë–ª–æ–∫ –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É
  int blockNum = response.substring(5).toInt();
  handleBlockDone(blockNum);
}
```

### Serial –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```cpp
// –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ ACTUATOR_CONFIG.h)
#define SERIAL_BAUD 115200

// ESP32
Mega1Serial.begin(SERIAL_BAUD, SERIAL_8N1, MEGA1_RX, MEGA1_TX);
Mega2Serial.begin(SERIAL_BAUD, SERIAL_8N1, MEGA2_RX, MEGA2_TX);

// Mega #1 –∏ #2
Serial1.begin(SERIAL_BAUD);  // TX1=18, RX1=19
```

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**

| ESP32 | ‚Üí | Mega #1 | ‚Üí | Mega #2 |
|-------|---|---------|---|---------|
| GPIO 25 (TX) | ‚Üí | Pin 19 (RX1) | | |
| GPIO 26 (RX) | ‚Üê | Pin 18 (TX1) | | |
| GPIO 12 (TX) | | | ‚Üí | Pin 19 (RX1) |
| GPIO 35 (RX) | | | ‚Üê | Pin 18 (TX1) |
| GND | ‚Äî | GND | ‚Äî | GND |

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ò–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (Next.js)

```typescript
// POST –∑–∞–ø—Ä–æ—Å –Ω–∞ ESP32
const response = await fetch('http://192.168.4.1/api/block?num=5&action=up&duration=10000', {
  method: 'POST'
});

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
// - num: –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞ (1-15)
// - action: –¥–µ–π—Å—Ç–≤–∏–µ (up, down, stop)
// - duration: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 2. –ò–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (curl)

```bash
# –ü–æ–¥–Ω—è—Ç—å –±–ª–æ–∫ 5 –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
curl -X POST "http://192.168.4.1/api/block?num=5&action=up&duration=10000"

# –û–ø—É—Å—Ç–∏—Ç—å –±–ª–æ–∫ 3 –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
curl -X POST "http://192.168.4.1/api/block?num=3&action=down&duration=5000"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫ 7
curl -X POST "http://192.168.4.1/api/block?num=7&action=stop"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –±–ª–æ–∫–∏
curl -X POST "http://192.168.4.1/api/stop"

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl http://192.168.4.1/api/status
# –û—Ç–≤–µ—Ç: Active:2,M1:OK,M2:OK
```

### 3. –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Mega (Serial Monitor)

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Mega –ë–ï–ó ESP32:**

```
–û—Ç–∫—Ä—ã—Ç—å Serial Monitor –Ω–∞ 115200 baud
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã:

BLOCK:1:UP:5000
BLOCK:1:STOP
BLOCK:5:DOWN:3000
PING
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```
ACK:1:UP
[BLOCK 1] UP (5000ms)
[TIMEOUT] Block 1 (UP)
DONE:1
```

### 4. Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
import serial
import time

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Mega
ser = serial.Serial('/dev/cu.usbmodem141021', 115200, timeout=1)
time.sleep(2)

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
cmd = "BLOCK:5:UP:10000\n"
ser.write(cmd.encode())

# –ß–∏—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç
while True:
    if ser.in_waiting:
        response = ser.readline().decode().strip()
        print(f"<< {response}")
    time.sleep(0.1)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫–∏

#### Mega #1

```bash
cd firmware/arduino_mega/actuator_mega1_v3

# –ß–µ—Ä–µ–∑ Arduino IDE:
# 1. –û—Ç–∫—Ä—ã—Ç—å actuator_mega1_v3.ino
# 2. Tools ‚Üí Board ‚Üí Arduino Mega
# 3. Tools ‚Üí Port ‚Üí /dev/cu.usbmodem...
# 4. Upload (Ctrl+U)

# –ß–µ—Ä–µ–∑ arduino-cli:
arduino-cli upload -p /dev/cu.usbmodem141021 --fqbn arduino:avr:mega:cpu=atmega2560
```

#### Mega #2

```bash
cd firmware/arduino_mega/actuator_mega2_v3
arduino-cli upload -p /dev/cu.usbmodem141022 --fqbn arduino:avr:mega:cpu=atmega2560
```

#### ESP32

```bash
cd firmware/esp32/rams_controller_v3

# –ß–µ—Ä–µ–∑ Arduino IDE:
# 1. –û—Ç–∫—Ä—ã—Ç—å rams_controller_v3.ino
# 2. Tools ‚Üí Board ‚Üí ESP32 Dev Module
# 3. Upload
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Serial –ª–æ–≥–∏

#### Mega #1 (Serial Monitor, 115200 baud):

```
========================================
  RAMS ACTUATOR CONTROLLER - MEGA #1
  Blocks 1-8 | Text Protocol v3.0
========================================
[INIT] Initializing pins for blocks 1-8...
  Block 1: Act1[22,23] Act2[24,25]
  Block 2: Act1[26,27] Act2[28,29]
  ...
[INIT] All pins initialized ‚úì
[READY] System initialized!
```

#### ESP32 (Serial Monitor, 115200 baud):

```
========================================
  RAMS CONTROLLER v3.0
  ESP32 + 2x Arduino Mega + WS2812B
  Text Protocol - Fast & Reliable
========================================

ACTUATOR BLOCKS CONFIGURATION
Total blocks: 15
Mega #1: blocks 1-8
Mega #2: blocks 9-15

Block 1 (Mega #1): Act1[22,23] Act2[24,25]
Block 2 (Mega #1): Act1[26,27] Act2[28,29]
...
Block 15 (Mega #2, 3 actuators):
  Actuator 1: UP=42, DOWN=43
  Actuator 2: UP=44, DOWN=45
  Actuator 3: UP=46, DOWN=47

[LED] FastLED initialized (10 strips, 538 LEDs) ‚úì
[MEGA] Mega #1 ready on GPIO25/26 ‚úì
[MEGA] Mega #2 ready on GPIO12/35 ‚úì
[WIFI] IP: 192.168.4.1
[READY] System initialized!
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –¢–µ—Å—Ç 1: –û–¥–∏–Ω–æ—á–Ω—ã–π –±–ª–æ–∫

```bash
curl -X POST "http://192.168.4.1/api/block?num=1&action=up&duration=3000"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥ ESP32:**
```
[BLOCK] 1 UP (3000ms) - Active: 1/2
[MEGA1 TX] BLOCK:1:UP:3000
[MEGA1 RX] ACK:1:UP
[BLOCK] 1 timeout (UP)
```

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥ Mega #1:**
```
[RX] BLOCK:1:UP:3000
[BLOCK 1] UP (3000ms)
[TX] ACK:1:UP
[TIMEOUT] Block 1 (UP)
[TX] DONE:1
```

#### –¢–µ—Å—Ç 2: –î–≤–∞ –±–ª–æ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–ª–∏–º–∏—Ç)

```bash
curl -X POST "http://192.168.4.1/api/block?num=1&action=up&duration=5000"
curl -X POST "http://192.168.4.1/api/block?num=2&action=up&duration=5000"
curl -X POST "http://192.168.4.1/api/block?num=3&action=up&duration=5000"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–ª–æ–∫–∏ 1 –∏ 2 –∑–∞–ø—É—Å—Ç—è—Ç—Å—è, –±–ª–æ–∫ 3 –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É:
```
ERROR:Max active blocks
```

#### –¢–µ—Å—Ç 3: Heartbeat (PING/PONG)

**ESP32 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PING –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã.

**–õ–æ–≥ ESP32:**
```
[MEGA1 TX] PING
[MEGA1 RX] PONG
[MEGA2 TX] PING
[MEGA2 RX] PONG
```

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Mega –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–°–∏–º–ø—Ç–æ–º:** ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `BLOCK:5:UP:10000`, –Ω–æ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Mega.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Serial Monitor Mega ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç?
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å baud rate (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 115200 –≤–µ–∑–¥–µ)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
   - ESP32 TX ‚Üí Mega RX
   - ESP32 RX ‚Üí Mega TX
   - –û–±—â–∞—è –∑–µ–º–ª—è (GND)

**–†–µ—à–µ–Ω–∏–µ:**
```cpp
// –ù–∞ Mega –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Serial1
Serial1.begin(115200);  // –î–æ–ª–∂–µ–Ω –±—ã—Ç—å 115200!

// –ù–∞ ESP32 –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∏–Ω—ã
Mega1Serial.begin(115200, SERIAL_8N1, 26, 25);  // RX=26, TX=25
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ê–∫—Ç—É–∞—Ç–æ—Ä—ã –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:** Mega –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É, –æ—Ç–≤–µ—á–∞–µ—Ç ACK, –Ω–æ –∞–∫—Ç—É–∞—Ç–æ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–ª—å—Ç–∞–∂ –Ω–∞ —Ä–µ–ª–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 5V)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –∞–∫—Ç—É–∞—Ç–æ—Ä–æ–≤ (12V/24V)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–µ–ª–µ (–∏–Ω–≤–µ—Ä—Å–Ω–∞—è: LOW=ON)

**–†–µ—à–µ–Ω–∏–µ:**
```cpp
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
digitalWrite(pin, RELAY_ON);   // LOW –¥–ª—è –∏–Ω–≤–µ—Ä—Å–Ω–æ–π –ª–æ–≥–∏–∫–∏
digitalWrite(pin, RELAY_OFF);  // HIGH –¥–ª—è –∏–Ω–≤–µ—Ä—Å–Ω–æ–π –ª–æ–≥–∏–∫–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ë–ª–æ–∫ 15 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º:** –ë–ª–æ–∫–∏ 1-14 —Ä–∞–±–æ—Ç–∞—é—Ç, –±–ª–æ–∫ 15 –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç.

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–ª–æ–∫ 15 –∏–º–µ–µ—Ç **3 –∞–∫—Ç—É–∞—Ç–æ—Ä–∞** (–Ω–µ 2!)

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–æ–¥ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ 3 –∞–∫—Ç—É–∞—Ç–æ—Ä–∞–º–∏:

```cpp
// –í actuator_mega2_v3.ino –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
if (config->actuatorCount == 3) {
  digitalWrite(config->actuator3.upPin, RELAY_ON);
  digitalWrite(config->actuator3.downPin, RELAY_OFF);
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: LED –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –∞–∫—Ç—É–∞—Ç–æ—Ä–∞–º–∏

**–°–∏–º–ø—Ç–æ–º:** –ê–∫—Ç—É–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ LED –Ω–µ –∑–∞–≥–æ—Ä–∞—é—Ç—Å—è.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –±–ª–æ–∫–æ–≤ –Ω–∞ LED –∑–æ–Ω—ã –≤ `setupBlockZones()`.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –∏–º–µ–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é LED –∑–æ–Ω—É.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | v2.0 (JSON) | v3.0 (Text) | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|-------------|-------------|-----------|
| –§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã | 45 –±–∞–π—Ç | 19 –±–∞–π—Ç | 58% –º–µ–Ω—å—à–µ |
| –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ | ~3 –º—Å | ~0.1 –º—Å | **30x –±—ã—Å—Ç—Ä–µ–µ** |
| RAM –Ω–∞ Mega | 256 –±–∞–π—Ç | 50 –±–∞–π—Ç | 80% –º–µ–Ω—å—à–µ |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | –û–±—â–∏–π —Ñ–∞–π–ª | –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ |
| –†–æ—É—Ç–∏–Ω–≥ | –•–∞—Ä–¥–∫–æ–¥ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –ü—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞ |

---

## üìù Changelog

### v3.0 (2026-02-15)

‚úÖ **NEW:** –û–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `ACTUATOR_CONFIG.h`
‚úÖ **NEW:** –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (–∑–∞–º–µ–Ω–∞ JSON)
‚úÖ **NEW:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –Ω–∞ Mega
‚úÖ **NEW:** Heartbeat (PING/PONG)
‚úÖ **NEW:** –õ–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (MAX 2)
‚úÖ **FIXED:** –ë–ª–æ–∫ 15 –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 3 –∞–∫—Ç—É–∞—Ç–æ—Ä–æ–≤
‚úÖ **IMPROVED:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤ 30x –±—ã—Å—Ç—Ä–µ–µ –ø–∞—Ä—Å–∏–Ω–≥)
‚úÖ **IMPROVED:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–Ω–∞ 80% –º–µ–Ω—å—à–µ)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∂–µ–ª–µ–∑–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ü–µ–≤—ã–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏ (endstops)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—á–∏–∫–∏ —Ç–æ–∫–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ SD –∫–∞—Ä—Ç—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–æ–∫

---

**–í–µ—Ä—Å–∏—è:** 3.0
**–î–∞—Ç–∞:** 15 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–ê–≤—Ç–æ—Ä:** RAMS Global Team

**‚ö†Ô∏è –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø ‚Äî –ì–û–¢–û–í–ê –ö PRODUCTION ‚ö†Ô∏è**
