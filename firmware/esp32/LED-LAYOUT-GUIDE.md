# Схемы подключения LED для различных макетов

## Обзор

Этот гайд показывает как правильно соединять WS2812B LED ленты для разных типов макетов:
- Круговой макет с радиальными секторами
- Линейный макет (улицы, здания в ряд)
- Комбинированный макет
- Макет со сложной геометрией

**ВАЖНО**: WS2812B - это адресная LED лента с направлением DATA IN → DATA OUT!

---

## Принцип работы WS2812B

### Направление сигнала

```
      DATA IN                    DATA OUT
         │                          │
         ▼                          ▼
    ┌────────┐    ┌────────┐    ┌────────┐
    │ LED 0  │───►│ LED 1  │───►│ LED 2  │───► ...
    └────────┘    └────────┘    └────────┘
```

**Правила**:
1. ✅ Сигнал идет только В ОДНУ СТОРОНУ (DATA IN → DATA OUT)
2. ✅ LED нумеруются последовательно (0, 1, 2, 3...)
3. ❌ НЕЛЬЗЯ подключать параллельно к одной Data line
4. ✅ МОЖНО разветвлять, но через отдельные GPIO пины ESP32

---

## Схема 1: Круговой макет с радиальными секторами

### Описание

Макет в форме круга или полукруга, где проекты расположены по радиусу от центра.

```
                    Проект 0
                       │
                       │
                   ┌───┴───┐
                   │       │
         Проект 3  │       │  Проект 1
                ───┤ ЦЕНТР ├───
                   │  ESP32│
         Проект 2  │       │  Проект 4
                   └───┬───┘
                       │
                       │
                    Проект 5
```

### Вариант A: Последовательное подключение (змейка)

Самый простой способ - соединить все проекты "змейкой":

```
ESP32 GPIO 16 (DATA OUT)
    │
    └──► Проект 0 (LED 0-29)
            │ DATA OUT
            ▼
         Проект 1 (LED 30-59)
            │ DATA OUT
            ▼
         Проект 2 (LED 60-89)
            │ DATA OUT
            ▼
         Проект 3 (LED 90-119)
            │ DATA OUT
            ▼
         Проект 4 (LED 120-149)
```

**Преимущества**:
- ✅ Простая проводка
- ✅ Один GPIO пин
- ✅ Легкая отладка

**Недостатки**:
- ❌ Длинные провода между проектами
- ❌ Если один проект отказывает, следующие тоже не работают
- ❌ Ограничение на общее количество LED (~600-800)

**Физическая прокладка**:
```
        START
          │
    ┌─────▼─────┐
    │ Проект 0  │
    │ IN ────OUT│
    └─────┬─────┘
          │ (провод 20-50см)
          │
    ┌─────▼─────┐
    │ Проект 1  │
    │ IN ────OUT│
    └─────┬─────┘
          │
         ...
```

**Код конфигурации**:
```cpp
projects[0].ledStart = 0;
projects[0].ledCount = 10;   // 30 физических LED (÷3 для 12V)

projects[1].ledStart = 10;
projects[1].ledCount = 10;

projects[2].ledStart = 20;
projects[2].ledCount = 10;
```

---

### Вариант B: Звезда от центра

LED ленты расходятся от центра (ESP32) к каждому проекту:

```
                 Проект 0
                  (PIN 16)
                    /
                   /
     Проект 3 ── ESP32 ── Проект 1
      (PIN 18)     │      (PIN 17)
                   │
                   │
                Проект 2
                 (PIN 19)
```

**ВАЖНО**: Для этого нужно несколько GPIO пинов на ESP32!

**Распиновка**:
```
GPIO 16 → Проект 0 (30 LED)
GPIO 17 → Проект 1 (30 LED)
GPIO 18 → Проект 2 (30 LED)
GPIO 19 → Проект 3 (30 LED)
GPIO 21 → Проект 4 (30 LED)
GPIO 22 → Проект 5 (30 LED)
```

**Код конфигурации (FastLED с несколькими GPIO)**:
```cpp
#define NUM_STRIPS 6
#define LEDS_PER_STRIP 10  // 30 физических LED

CRGB leds[NUM_STRIPS][LEDS_PER_STRIP];

void setup() {
  FastLED.addLeds<WS2811, 16, RGB>(leds[0], LEDS_PER_STRIP);
  FastLED.addLeds<WS2811, 17, RGB>(leds[1], LEDS_PER_STRIP);
  FastLED.addLeds<WS2811, 18, RGB>(leds[2], LEDS_PER_STRIP);
  FastLED.addLeds<WS2811, 19, RGB>(leds[3], LEDS_PER_STRIP);
  FastLED.addLeds<WS2811, 21, RGB>(leds[4], LEDS_PER_STRIP);
  FastLED.addLeds<WS2811, 22, RGB>(leds[5], LEDS_PER_STRIP);
}

// Управление проектом
void setProjectColor(int projectId, CRGB color) {
  for (int i = 0; i < LEDS_PER_STRIP; i++) {
    leds[projectId][i] = color;
  }
  FastLED.show();
}
```

**Преимущества**:
- ✅ Независимые линии (отказ одной не влияет на другие)
- ✅ Короткие провода от центра
- ✅ Можно использовать до 8 параллельных линий

**Недостатки**:
- ❌ Больше GPIO пинов занято
- ❌ Сложнее код
- ❌ Лимит LED на каждой линии (~200 адресов)

---

### Вариант C: Гибридная схема (рекомендуется)

Комбинация последовательного и звездообразного:

```
ESP32 GPIO 16 ──► Сектор A (Проекты 0-4)
      GPIO 17 ──► Сектор B (Проекты 5-9)
      GPIO 18 ──► Сектор C (Проекты 10-14)
      GPIO 19 ──► Сектор D (Проекты 15-19)
```

Каждый сектор - это последовательная цепочка 4-5 проектов.

**Пример для Сектора A**:
```
GPIO 16 → Проект 0 → Проект 1 → Проект 2 → Проект 3 → Проект 4
         (LED 0-9) (LED 10-19) (LED 20-29) (LED 30-39) (LED 40-49)
```

**Преимущества**:
- ✅ Баланс между простотой и надежностью
- ✅ Меньше проводов чем в "звезде"
- ✅ Отказоустойчивость по секторам
- ✅ Подходит для больших макетов (1000+ LED)

**Код конфигурации**:
```cpp
// Сектор A (GPIO 16)
CRGB sector_A[50];  // 5 проектов × 10 адресов
FastLED.addLeds<WS2811, 16, RGB>(sector_A, 50);

// Сектор B (GPIO 17)
CRGB sector_B[50];
FastLED.addLeds<WS2811, 17, RGB>(sector_B, 50);

// ... и т.д.
```

---

## Схема 2: Линейный макет (улицы/здания в ряд)

### Описание

Проекты расположены в линию (например, вдоль улицы или квартала).

```
┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐
│Пр. 0 │  │Пр. 1 │  │Пр. 2 │  │Пр. 3 │  │Пр. 4 │
└──────┘  └──────┘  └──────┘  └──────┘  └──────┘
   ├─────────┼─────────┼─────────┼─────────┤
  DATA ──────────────────────────────────►
```

### Подключение

Самый простой случай - последовательное подключение:

```
ESP32 GPIO 16
    │
    └──► Проект 0 (LED 0-29)
            │
            ├──► Проект 1 (LED 30-59)
                   │
                   ├──► Проект 2 (LED 60-89)
                          │
                          └──► ...
```

**Прокладка проводов**:
- Под макетом или вдоль основания
- Провода между проектами: 10-30см
- DATA провод: тонкий (0.5мм²)
- Питание +12V/GND: толще (1.5мм²)

**Питание**:

ВАЖНО: Подавать питание каждые 150-200 LED!

```
БП 12V ──┬──► Проект 0 (+12V, GND)
         │
         ├──► Проект 2 (+12V, GND)  // Инжекция питания
         │
         └──► Проект 4 (+12V, GND)  // Инжекция питания

Data line: ESP32 → Пр.0 → Пр.1 → Пр.2 → ... (непрерывно)
```

---

## Схема 3: Макет по внутреннему радиусу

### Описание

Проекты расположены по дуге или окружности.

```
              Проект 0
            /          \
        Проект 3      Проект 1
           |             |
        Проект 2  ──  Центр  ──  Проект 4
                        ╱ ╲
                    ESP32  БП
```

### Вариант A: По часовой стрелке

```
ESP32 GPIO 16 ──► Проект 0 (0°)
                     │
                     ▼
                  Проект 1 (45°)
                     │
                     ▼
                  Проект 2 (90°)
                     │
                     ▼
                  Проект 3 (135°)
                     │
                     ...
```

**Физическая прокладка**:
- Провода идут по дуге
- Крепление: кабель-каналы или стяжки
- Запас провода на изгибах: +20%

### Вариант B: К центру и обратно

Для симметричных макетов:

```
                Проект 0 ◄─────┐
                    │          │
                    ▼          │
ESP32 GPIO 16 ──► Проект 1     │
                    │          │
                    ▼    DATA OUT
                 Проект 2 ──────┘
                                ▲
                                │
                            Проект 3
```

---

## Схема 4: Разделенные линии (несколько зон)

### Описание

Макет разделен на несколько независимых зон.

```
┌───────────────┐       ┌───────────────┐
│   ЗОНА A      │       │   ЗОНА B      │
│  (Проекты 0-5)│       │ (Проекты 6-11)│
└───────────────┘       └───────────────┘
        │                       │
        │ GPIO 16               │ GPIO 17
        │                       │
        └───────────┬───────────┘
                    │
                 ┌──▼──┐
                 │ESP32│
                 └─────┘
```

### Подключение

Каждая зона на отдельном GPIO:

```
GPIO 16 → Зона A: Проект 0 → 1 → 2 → 3 → 4 → 5
GPIO 17 → Зона B: Проект 6 → 7 → 8 → 9 → 10 → 11
GPIO 18 → Зона C: Проект 12 → 13 → 14 → ...
```

**Преимущества**:
- Можно выключать целые зоны
- Отказ в одной зоне не влияет на другие
- Более гибкая анимация (разные эффекты по зонам)

---

## Практические советы

### 1. Маркировка проводов

Используйте цветовую маркировку:

```
Красный:   +12V (питание)
Черный:    GND (земля)
Зеленый:   DATA (сигнал)
Белый:     DATA OUT (для следующего проекта)
```

Наклейте бирки на провода:
```
"Проект 0 → Проект 1 DATA"
"БП → Проект 2 +12V"
```

### 2. Тестирование по частям

1. Подключить первый проект
2. Загрузить тестовый код
3. Убедиться что работает
4. Добавить следующий проект
5. Повторить

**Тестовый код**:
```cpp
void loop() {
  // Загорается каждый проект по очереди
  for (int projectId = 0; projectId < NUM_PROJECTS; projectId++) {
    highlightProject(projectId);
    delay(2000);
    turnOffProject(projectId);
  }
}
```

### 3. Длина проводов

**Data линия** (сигнал):
- Максимум: 3-5 метров от ESP32
- Если дальше: использовать Level Repeater или дополнительный ESP32

**Питание** (+12V):
- Инжекция каждые 150-200 LED (50-70 адресов для 12V)
- Сечение провода: 1.5-2.5 мм²

**Расчет падения напряжения**:
```
ΔV = (I × R) = (I × ρ × L / A)

Для медного провода 1.5мм² на 5м при токе 3А:
ΔV ≈ 0.4V (допустимо)

Для 2.5мм² на 10м при токе 5А:
ΔV ≈ 0.4V (допустимо)
```

### 4. Крепление

**Варианты крепления LED лент**:
1. Двусторонний скотч (на обратной стороне ленты)
2. Кабель-каналы 10×10мм
3. Алюминиевый профиль (также работает как радиатор)
4. Стяжки (для временного монтажа)

**Крепление проводов**:
- Стяжки каждые 20-30см
- Избегать острых углов (радиус >2см)
- Не пережимать провода

---

## Диагностика проблем

### LED не загораются

| Симптом | Причина | Решение |
|---------|---------|---------|
| Совсем не горят | Нет питания | Проверить +12V на ленте |
| Первый LED горит, остальные нет | Нет Data сигнала | Проверить Data провод, Level Shifter |
| Горят первые N, дальше нет | Обрыв в цепи | Найти место обрыва, проверить пайку |
| Мерцают | Плохое питание | Добавить конденсатор, проверить БП |
| Неправильные цвета | Неверный COLOR_ORDER | Изменить GRB ↔ RGB в коде |

### Отладочный код

```cpp
void testSequential() {
  Serial.println("Testing LEDs sequentially...");

  for (int i = 0; i < NUM_LEDS; i++) {
    leds[i] = CRGB::Red;
    FastLED.show();
    Serial.print("LED #");
    Serial.println(i);
    delay(100);

    leds[i] = CRGB::Black;
  }
}

void testByProject() {
  Serial.println("Testing by project...");

  for (int proj = 0; proj < NUM_PROJECTS; proj++) {
    Serial.print("Testing project #");
    Serial.println(proj);

    int start = projects[proj].ledStart;
    int count = projects[proj].ledCount;

    for (int i = 0; i < count; i++) {
      leds[start + i] = CRGB::Green;
    }
    FastLED.show();
    delay(2000);

    // Clear
    for (int i = 0; i < count; i++) {
      leds[start + i] = CRGB::Black;
    }
    FastLED.show();
  }
}
```

---

## Схема подключения для вашего макета

### Если у вас круговой макет:

**Рекомендую**: Гибридная схема (Вариант C)

1. Разделить проекты на 4 сектора
2. Каждый сектор на отдельный GPIO
3. Внутри сектора - последовательно

```
         Сектор A (GPIO 16)
         Проекты 0-6
            /
           /
    ESP32 ── Сектор B (GPIO 17)
       \     Проекты 7-13
        \
         Сектор C (GPIO 18)
         Проекты 14-20
```

### Если у вас линейный макет:

**Рекомендую**: Последовательное подключение (Схема 2)

```
ESP32 → Пр.0 → Пр.1 → Пр.2 → ... → Пр.27
         ↑           ↑            ↑
       БП 12V    БП 12V       БП 12V
     (инжекция) (инжекция)  (инжекция)
```

---

## Следующие шаги

1. ✅ Определить тип вашего макета
2. ✅ Выбрать схему подключения
3. ✅ Измерить расстояния между проектами
4. ✅ Рассчитать длину проводов (+20% запас)
5. ✅ Купить материалы (см. SHOPPING-LIST.md)
6. ✅ Подключить и протестировать первый проект
7. ✅ Постепенно добавлять остальные

---

**Дата**: 2026-01-27
**Версия**: 1.0
**Для проекта**: RAMS Interactive Hub

**См. также**:
- `WIRING-12V.md` - Детальное подключение компонентов
- `PROJECT-CONFIG-EXAMPLE.h` - Пример конфигурации
- `SHOPPING-LIST.md` - Что купить
