# ФИНАЛЬНАЯ РАБОЧАЯ ПРОШИВКА - Arduino Mega 1

**Дата:** 15 февраля 2026
**Статус:** ✅ ПРОТЕСТИРОВАНО И РАБОТАЕТ

## Описание

Управляет 8 блоками актуаторов (16 актуаторов всего - по 2 на блок).
Цикл: 90 секунд, затем повтор.

## Последовательность работы

1. **STAGE 1** (10с): Block 1 UP
2. **STAGE 2** (10с): Block 1 DOWN + Block 2 UP (одновременно)
3. **STAGE 3** (10с): Block 2 DOWN + Block 3 UP (одновременно)
4. **STAGE 4** (10с): Block 3 DOWN + Block 4 UP (одновременно)
5. **STAGE 5** (10с): Block 4 DOWN + Block 5 UP (одновременно)
6. **STAGE 6** (10с): Block 5 DOWN + Block 6 UP (одновременно)
7. **STAGE 7** (10с): Block 6 DOWN + Block 7 UP (одновременно)
8. **STAGE 8** (10с): Block 7 DOWN + Block 8 UP (одновременно)
9. **STAGE 9** (10с): Block 8 DOWN

**Полный цикл:** 90 секунд

## Логика реле

**ИНВЕРСНАЯ ЛОГИКА:**
- `LOW` = Реле ВКЛЮЧЕНО (актуатор работает)
- `HIGH` = Реле ВЫКЛЮЧЕНО (актуатор не работает)

## Маппинг пинов

### Блок 1 (пины 22-25)
- Актуатор 1: UP = 22, DOWN = 23
- Актуатор 2: UP = 24, DOWN = 25

### Блок 2 (пины 26-29)
- Актуатор 1: UP = 26, DOWN = 27
- Актуатор 2: UP = 28, DOWN = 29

### Блок 3 (пины 30-33)
- Актуатор 1: UP = 30, DOWN = 31
- Актуатор 2: UP = 32, DOWN = 33

### Блок 4 (пины 34-37)
- Актуатор 1: UP = 34, DOWN = 35
- Актуатор 2: UP = 36, DOWN = 37

### Блок 5 (пины 38-41)
- Актуатор 1: UP = 38, DOWN = 39
- Актуатор 2: UP = 40, DOWN = 41

### Блок 6 (пины 50-53) ⚠️ ВАЖНО!
- Актуатор 1: UP = 50, DOWN = 51
- Актуатор 2: UP = 52, DOWN = 53

### Блок 7 (пины 42-45) ⚠️ ВАЖНО!
- Актуатор 1: UP = 42, DOWN = 43
- Актуатор 2: UP = 44, DOWN = 45

### Блок 8 (пины 46-49) ⚠️ ВАЖНО!
- Актуатор 1: UP = 46, DOWN = 47
- Актуатор 2: UP = 48, DOWN = 49

## Важные замечания

### ⚠️ Порядок блоков 6, 7, 8
Физическая проводка отличается от логического порядка:
- **Пины 42-45** → **Block 7** (не Block 6!)
- **Пины 46-49** → **Block 8** (не Block 7!)
- **Пины 50-53** → **Block 6** (не Block 8!)

Это учтено в прошивке!

### ⚠️ Паттерн пинов
Пины чередуются для каждого актуатора:
- Act1: UP = чётный, DOWN = чётный+1
- Act2: UP = чётный+2, DOWN = чётный+3

Например Block 1:
- Act1: UP=22, DOWN=23
- Act2: UP=24, DOWN=25

**НЕ:**
- UP = 22,23
- DOWN = 24,25

### ⚠️ Порядок digitalWrite - КРИТИЧНО!

**ВАЖНО:** Порядок команд digitalWrite имеет значение для стабильной работы!

```cpp
// Правильный порядок для blockDown():
digitalWrite(act1Down, LOW);   // 1. Сначала включаем DOWN
digitalWrite(act2Down, LOW);
digitalWrite(act1Up, HIGH);    // 2. Потом выключаем UP
digitalWrite(act2Up, HIGH);

// НЕ наоборот! Иначе Block 8 может не работать!
```

### ⚠️ Питание
- Arduino Mega: 5V через USB
- Актуаторы: 12V/24V отдельный блок питания (ОБЯЗАТЕЛЬНО!)
- Реле переключают цепь актуаторов

## Прошивка

**Файл:** `actuator_mega1_FINAL_WORKING.ino`

**Загрузка:**
```bash
arduino-cli upload -p /dev/cu.usbmodem141021 \
  --fqbn arduino:avr:mega:cpu=atmega2560 \
  actuator_mega1_FINAL_WORKING
```

**Serial Monitor:**
```bash
arduino-cli monitor -p /dev/cu.usbmodem141021 -c baudrate=115200
```

## Тестирование

### ✅ Протестировано:
- [x] Все 8 блоков работают
- [x] Актуаторы поднимаются и опускаются
- [x] Одновременная работа (один UP, другой DOWN)
- [x] Правильный порядок блоков 1-8
- [x] Инверсная логика реле
- [x] Длительность 10 секунд на этап
- [x] Полный цикл 90 секунд

### Известные проблемы:
- Нет

## История изменений

**v1.1 - 2026-02-15 (09:30)**
- ✅ ИСПРАВЛЕНО: Порядок digitalWrite в blockDown()
- Теперь: сначала DOWN = LOW, потом UP = HIGH
- Block 8 теперь работает стабильно в общей последовательности
- Все 8 блоков протестированы и работают ✅

**v1.0 - 2026-02-15 (09:28)**
- Финальная рабочая версия
- Исправлен маппинг блоков 6,7,8
- Добавлена пауза STOP перед STAGE 9
- Инверсная логика реле (LOW = ON)
- Все 8 блоков протестированы и работают

---

**⚠️ НЕ ИЗМЕНЯТЬ БЕЗ НЕОБХОДИМОСТИ! РАБОЧАЯ ВЕРСИЯ! ⚠️**
